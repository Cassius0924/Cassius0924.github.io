<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jetson Xavier NX 安装 CUDA 支持的 PyTorch 指南 | Cassius0924 的博客</title><meta name=keywords content="Jetson,PyTorch,CUDA,Installation,Tutorial"><meta name=description content="本指南将帮助开发者完成在 Jetson Xavier NX 上安装 CUDA 支持的 PyTorch。
安装方法在 Jetson 上安装 Pytorch 只有两种方法。

一种是直接安装他人已经编译好的 PyTorch 轮子；
一种是自己从头开始开始构建 PyTorch 轮子并且安装。

使用轮子安装可以从我的 GitHub 仓库 直接下载我编译好的 PyTorch 轮子（torch-1.13.0-cuda-11.4-python-3.8-aarch64）。
安装前先确保 python 版本为 PyTorch 轮子对应的 Python 3.8。
下载完毕后使用pip install安装：
sudo -H pip install torch-1.13.0a0+git7c98e70-cp38-cp38-linux_aarch64.whl
如果你以前安装过 torch 的其他版本，则需要添加--force-reinstall覆盖安装。
其他低于 CUDA 11 的 PyTorch 轮子可以在 Qengineering 的 GitHub 仓库 寻找。
编译源码安装接下来说一下重点，自己从源码构建轮子并安装。自行构建需要花费数个小时的时间。
PyTroch 1.11.0 以及以上版本只能在 Ubuntu 20.04 上安装。
安装依赖sudo apt-get update
sudo apt-get upgrade
sudo apt-get install ninja-build git cmake 
sudo apt-get install libjpeg-dev libopenmpi-dev libomp-dev ccache libopenblas-dev libblas-dev libeigen3-dev
sudo pip3 install -U --user wheel mock pillow
sudo -H pip3 install testresources setuptools==58.3.0 scikit-build
下载源码请克隆自己需要的 PyTorch 版本，修改-b后的版本参数。"><meta name=author content="Cassius0924"><link rel=canonical href=https://blog.cassdev.com/posts/jetson-xavier-nx-%E5%AE%89%E8%A3%85-cuda-%E6%94%AF%E6%8C%81%E7%9A%84-pytorch-%E6%8C%87%E5%8D%97/><link crossorigin=anonymous href=/assets/css/stylesheet.4f5249ac184c033613d94c5267209e90161d3a93365c2feb0ad3960a4bbb6393.css integrity="sha256-T1JJrBhMAzYT2UxSZyCekBYdOpM2XC/rCtOWCku7Y5M=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.cassdev.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.cassdev.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.cassdev.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.cassdev.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.cassdev.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://blog.cassdev.com/posts/jetson-xavier-nx-%E5%AE%89%E8%A3%85-cuda-%E6%94%AF%E6%8C%81%E7%9A%84-pytorch-%E6%8C%87%E5%8D%97/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://blog.cassdev.com/posts/jetson-xavier-nx-%E5%AE%89%E8%A3%85-cuda-%E6%94%AF%E6%8C%81%E7%9A%84-pytorch-%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="Cassius0924 的博客"><meta property="og:title" content="Jetson Xavier NX 安装 CUDA 支持的 PyTorch 指南"><meta property="og:description" content="本指南将帮助开发者完成在 Jetson Xavier NX 上安装 CUDA 支持的 PyTorch。
安装方法在 Jetson 上安装 Pytorch 只有两种方法。
一种是直接安装他人已经编译好的 PyTorch 轮子； 一种是自己从头开始开始构建 PyTorch 轮子并且安装。 使用轮子安装可以从我的 GitHub 仓库 直接下载我编译好的 PyTorch 轮子（torch-1.13.0-cuda-11.4-python-3.8-aarch64）。
安装前先确保 python 版本为 PyTorch 轮子对应的 Python 3.8。
下载完毕后使用pip install安装：
sudo -H pip install torch-1.13.0a0+git7c98e70-cp38-cp38-linux_aarch64.whl 如果你以前安装过 torch 的其他版本，则需要添加--force-reinstall覆盖安装。
其他低于 CUDA 11 的 PyTorch 轮子可以在 Qengineering 的 GitHub 仓库 寻找。
编译源码安装接下来说一下重点，自己从源码构建轮子并安装。自行构建需要花费数个小时的时间。
PyTroch 1.11.0 以及以上版本只能在 Ubuntu 20.04 上安装。
安装依赖sudo apt-get update sudo apt-get upgrade sudo apt-get install ninja-build git cmake sudo apt-get install libjpeg-dev libopenmpi-dev libomp-dev ccache libopenblas-dev libblas-dev libeigen3-dev sudo pip3 install -U --user wheel mock pillow sudo -H pip3 install testresources setuptools==58.3.0 scikit-build 下载源码请克隆自己需要的 PyTorch 版本，修改-b后的版本参数。"><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-16T11:20:31+08:00"><meta property="article:modified_time" content="2024-06-16T11:20:31+08:00"><meta property="article:tag" content="Jetson"><meta property="article:tag" content="PyTorch"><meta property="article:tag" content="CUDA"><meta property="article:tag" content="Installation"><meta property="article:tag" content="Tutorial"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jetson Xavier NX 安装 CUDA 支持的 PyTorch 指南"><meta name=twitter:description content="本指南将帮助开发者完成在 Jetson Xavier NX 上安装 CUDA 支持的 PyTorch。
安装方法在 Jetson 上安装 Pytorch 只有两种方法。

一种是直接安装他人已经编译好的 PyTorch 轮子；
一种是自己从头开始开始构建 PyTorch 轮子并且安装。

使用轮子安装可以从我的 GitHub 仓库 直接下载我编译好的 PyTorch 轮子（torch-1.13.0-cuda-11.4-python-3.8-aarch64）。
安装前先确保 python 版本为 PyTorch 轮子对应的 Python 3.8。
下载完毕后使用pip install安装：
sudo -H pip install torch-1.13.0a0+git7c98e70-cp38-cp38-linux_aarch64.whl
如果你以前安装过 torch 的其他版本，则需要添加--force-reinstall覆盖安装。
其他低于 CUDA 11 的 PyTorch 轮子可以在 Qengineering 的 GitHub 仓库 寻找。
编译源码安装接下来说一下重点，自己从源码构建轮子并安装。自行构建需要花费数个小时的时间。
PyTroch 1.11.0 以及以上版本只能在 Ubuntu 20.04 上安装。
安装依赖sudo apt-get update
sudo apt-get upgrade
sudo apt-get install ninja-build git cmake 
sudo apt-get install libjpeg-dev libopenmpi-dev libomp-dev ccache libopenblas-dev libblas-dev libeigen3-dev
sudo pip3 install -U --user wheel mock pillow
sudo -H pip3 install testresources setuptools==58.3.0 scikit-build
下载源码请克隆自己需要的 PyTorch 版本，修改-b后的版本参数。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.cassdev.com/posts/"},{"@type":"ListItem","position":2,"name":"Jetson Xavier NX 安装 CUDA 支持的 PyTorch 指南","item":"https://blog.cassdev.com/posts/jetson-xavier-nx-%E5%AE%89%E8%A3%85-cuda-%E6%94%AF%E6%8C%81%E7%9A%84-pytorch-%E6%8C%87%E5%8D%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jetson Xavier NX 安装 CUDA 支持的 PyTorch 指南","name":"Jetson Xavier NX 安装 CUDA 支持的 PyTorch 指南","description":"本指南将帮助开发者完成在 Jetson Xavier NX 上安装 CUDA 支持的 PyTorch。\n安装方法在 Jetson 上安装 Pytorch 只有两种方法。\n一种是直接安装他人已经编译好的 PyTorch 轮子； 一种是自己从头开始开始构建 PyTorch 轮子并且安装。 使用轮子安装可以从我的 GitHub 仓库 直接下载我编译好的 PyTorch 轮子（torch-1.13.0-cuda-11.4-python-3.8-aarch64）。\n安装前先确保 python 版本为 PyTorch 轮子对应的 Python 3.8。\n下载完毕后使用pip install安装：\nsudo -H pip install torch-1.13.0a0+git7c98e70-cp38-cp38-linux_aarch64.whl 如果你以前安装过 torch 的其他版本，则需要添加--force-reinstall覆盖安装。\n其他低于 CUDA 11 的 PyTorch 轮子可以在 Qengineering 的 GitHub 仓库 寻找。\n编译源码安装接下来说一下重点，自己从源码构建轮子并安装。自行构建需要花费数个小时的时间。\nPyTroch 1.11.0 以及以上版本只能在 Ubuntu 20.04 上安装。\n安装依赖sudo apt-get update sudo apt-get upgrade sudo apt-get install ninja-build git cmake sudo apt-get install libjpeg-dev libopenmpi-dev libomp-dev ccache libopenblas-dev libblas-dev libeigen3-dev sudo pip3 install -U --user wheel mock pillow sudo -H pip3 install testresources setuptools==58.3.0 scikit-build 下载源码请克隆自己需要的 PyTorch 版本，修改-b后的版本参数。\n","keywords":["Jetson","PyTorch","CUDA","Installation","Tutorial"],"articleBody":"本指南将帮助开发者完成在 Jetson Xavier NX 上安装 CUDA 支持的 PyTorch。\n安装方法在 Jetson 上安装 Pytorch 只有两种方法。\n一种是直接安装他人已经编译好的 PyTorch 轮子； 一种是自己从头开始开始构建 PyTorch 轮子并且安装。 使用轮子安装可以从我的 GitHub 仓库 直接下载我编译好的 PyTorch 轮子（torch-1.13.0-cuda-11.4-python-3.8-aarch64）。\n安装前先确保 python 版本为 PyTorch 轮子对应的 Python 3.8。\n下载完毕后使用pip install安装：\nsudo -H pip install torch-1.13.0a0+git7c98e70-cp38-cp38-linux_aarch64.whl 如果你以前安装过 torch 的其他版本，则需要添加--force-reinstall覆盖安装。\n其他低于 CUDA 11 的 PyTorch 轮子可以在 Qengineering 的 GitHub 仓库 寻找。\n编译源码安装接下来说一下重点，自己从源码构建轮子并安装。自行构建需要花费数个小时的时间。\nPyTroch 1.11.0 以及以上版本只能在 Ubuntu 20.04 上安装。\n安装依赖sudo apt-get update sudo apt-get upgrade sudo apt-get install ninja-build git cmake sudo apt-get install libjpeg-dev libopenmpi-dev libomp-dev ccache libopenblas-dev libblas-dev libeigen3-dev sudo pip3 install -U --user wheel mock pillow sudo -H pip3 install testresources setuptools==58.3.0 scikit-build 下载源码请克隆自己需要的 PyTorch 版本，修改-b后的版本参数。\ngit clone -b v1.13.0 --depth=1 --recursive https://github.com/pytorch/pytorch.git cd pytorch 扩大交换内存构建 PyTorch 需要大于 4GB 的 RAM 和 2GB 的交换内存。\n先使用free -m查看当前的交换内存。\n安装dphys-swapfiel：\nsudo apt-get install dphys-swapfile 需要修改两个文件/sbin/dphys-swapfile和/etc/dphys-swapfile。\n先修改/sbin/dphys-swapfile的第30行，将CONF_MAXSWAP=2048修改成4096：\nsudo vim /sbin/dphys-swapfile 再修改/etc/dphys-swapfile的第26行，将#去掉，后面加上4096：\nsudo vim /etc/dphys-swapfile 保存修改后重启系统。\nsudo reboot 重启完毕后可以使用 free -m 查看交换内存是否扩大成功。\n使用 GCC请使用 GCC 和 G++ 编译器，如果使用 GNU 编译器会导致浮点数出现错误的问题，使用 Clang 编译器在构建 CUDA 11.4 的 PyTorch 时候会报错。\n设置 CUDA 版本修改环境变量修改系统环境变量，如果你使用的是 bash 则修改 ~/.bashrc，如果使用 zsh 则修改 ~/.zshrc。\nvim ~/.zshrc #或 ~/.bashrc 在文件末尾添加三行：\nexport CUDA_HOME=/usr/local/cuda export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64 export PATH=$PATH:$CUDA_HOME/bin 如果你之前添加过 CUDA 的环境变量，则直接在对应行修改。\n保存并退出，应用修改：\nsource ~/.zshrc #或 ~/.bashrc 切换 CUDA 版本先切换系统 CUDA 版本到即将编译的 CUDA 版本，这里以 CUDA 11.4 为例。\nsudo update-alternatives --config cuda 选择2，回车。\n修改 CMakeLists.txt需要在 CMakeLists.txt 文件里指定 CUDA 编译器的路径。\ncd pytorch vim CMakeLists.txt 在 project(Torch CXX C)上方添加一行 set(CMAKE_CUDA_COMPILER /usr/local/cuda/bin/nvcc)\n保存并退出。\n构建 PyTorch设置 Ninja 构建参数需要添加一些环境变量。\nexport BUILD_CAFFE2_OPS=OFF export USE_FBGEMM=OFF export USE_FAKELOWP=OFF export BUILD_TEST=OFF export USE_MKLDNN=OFF export USE_NNPACK=OFF export USE_XNNPACK=OFF export USE_QNNPACK=OFF export USE_PYTORCH_QNNPACK=OFF export USE_CUDA=ON export USE_CUDNN=ON export TORCH_CUDA_ARCH_LIST=\"5.3;6.2;7.2\" export USE_NCCL=OFF export USE_SYSTEM_NCCL=OFF export USE_OPENCV=OFF export MAX_JOBS=4 export PATH=/usr/lib/ccache:$PATH export CC=gcc export CXX=g++ export CUDACXX=/usr/local/cuda/bin/nvcc export CUDA_TOOLKIT_ROOT_DIR=/usr/local/cuda sudo ln -s /usr/lib/aarch64-linux-gnu/libcublas.so /usr/local/cuda/lib64/libcublas.so 开始构建 PyTorchpython3 setup.py bdist_wheel 如果构建过程中报错，需要重新构建，请先用python3 setup.py clean重置构建。\n安装 PyTorch经过漫长的编译，编译好的.whl轮子文件会放在dist文件夹里。\ncd dist sudo -H pip3 install .whl 如果你以前安装过 torch 的其他版本，则需要添加--force-reinstall覆盖安装：\nsudo -H pip3 install .whl --force-reinstall 验证安装导入验证 torch 不能在 PyTorch 源代码目录，否则会报错，先用cd ../..退出源代码文件夹。\npython3 -c \"import torch as t; print(t.__version__); print(t.version.cuda); print(t.cuda.is_available());\" 大功告成！\n清理空间先停 dphys-swapfile：\nsudo /etc/init.d/dphys-swapfile stop 如果磁盘空间紧缺，可以将 PyTorch 源代码删除，不过删除前建议先将 Jetson 辛辛苦苦构建 PyTorch 轮子备份保存一下。\nmv pytorch/dist/*.whl ~ 删除源代码：\nrm -r pytorch ","wordCount":"327","inLanguage":"zh","datePublished":"2024-06-16T11:20:31+08:00","dateModified":"2024-06-16T11:20:31+08:00","author":{"@type":"Person","name":"Cassius0924"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.cassdev.com/posts/jetson-xavier-nx-%E5%AE%89%E8%A3%85-cuda-%E6%94%AF%E6%8C%81%E7%9A%84-pytorch-%E6%8C%87%E5%8D%97/"},"publisher":{"@type":"Organization","name":"Cassius0924 的博客","logo":{"@type":"ImageObject","url":"https://blog.cassdev.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.cassdev.com/ accesskey=h title="Cassius0924 的博客 (Alt + H)">Cassius0924 的博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.cassdev.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://blog.cassdev.com/ title="Cassius0924 的博客"><span>首页</span></a></li><li><a href=https://blog.cassdev.com/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.cassdev.com/mind-space/ title=思维空间><span>思维空间</span></a></li><li><a href=https://blog.cassdev.com/tags/ title=标签><span>标签</span></a></li><li><a href=https://blog.cassdev.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.cassdev.com/friends/ title=友链><span>友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.cassdev.com/>主页</a>&nbsp;»&nbsp;<a href=https://blog.cassdev.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Jetson Xavier NX 安装 CUDA 支持的 PyTorch 指南</h1><div class=post-meta><span title='2024-06-16 11:20:31 +0800 +0800'>2024年06月16日</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;Cassius0924</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95 aria-label=安装方法>安装方法</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e8%bd%ae%e5%ad%90%e5%ae%89%e8%a3%85 aria-label=使用轮子安装>使用轮子安装</a></li><li><a href=#%e7%bc%96%e8%af%91%e6%ba%90%e7%a0%81%e5%ae%89%e8%a3%85 aria-label=编译源码安装>编译源码安装</a><ul><li><a href=#%e5%ae%89%e8%a3%85%e4%be%9d%e8%b5%96 aria-label=安装依赖>安装依赖</a></li><li><a href=#%e4%b8%8b%e8%bd%bd%e6%ba%90%e7%a0%81 aria-label=下载源码>下载源码</a></li><li><a href=#%e6%89%a9%e5%a4%a7%e4%ba%a4%e6%8d%a2%e5%86%85%e5%ad%98 aria-label=扩大交换内存>扩大交换内存</a></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8-gcc aria-label="使用 GCC">使用 GCC</a></li><li><a href=#%e8%ae%be%e7%bd%ae-cuda-%e7%89%88%e6%9c%ac aria-label="设置 CUDA 版本">设置 CUDA 版本</a><ul><li><a href=#%e4%bf%ae%e6%94%b9%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f aria-label=修改环境变量>修改环境变量</a></li><li><a href=#%e5%88%87%e6%8d%a2-cuda-%e7%89%88%e6%9c%ac aria-label="切换 CUDA 版本">切换 CUDA 版本</a></li><li><a href=#%e4%bf%ae%e6%94%b9-cmakeliststxt aria-label="修改 CMakeLists.txt">修改 CMakeLists.txt</a></li></ul></li><li><a href=#%e6%9e%84%e5%bb%ba-pytorch aria-label="构建 PyTorch">构建 PyTorch</a><ul><li><a href=#%e8%ae%be%e7%bd%ae-ninja-%e6%9e%84%e5%bb%ba%e5%8f%82%e6%95%b0 aria-label="设置 Ninja 构建参数">设置 Ninja 构建参数</a></li><li><a href=#%e5%bc%80%e5%a7%8b%e6%9e%84%e5%bb%ba-pytorch aria-label="开始构建 PyTorch">开始构建 PyTorch</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85-pytorch aria-label="安装 PyTorch">安装 PyTorch</a></li><li><a href=#%e9%aa%8c%e8%af%81%e5%ae%89%e8%a3%85 aria-label=验证安装>验证安装</a></li><li><a href=#%e6%b8%85%e7%90%86%e7%a9%ba%e9%97%b4 aria-label=清理空间>清理空间</a></li></ul></div></details></div><div class=post-content><p>本指南将帮助开发者完成在 Jetson Xavier NX 上安装 CUDA 支持的 PyTorch。</p><h2 id=安装方法>安装方法<a hidden class=anchor aria-hidden=true href=#安装方法>#</a></h2><p>在 Jetson 上安装 Pytorch 只有两种方法。</p><ul><li>一种是直接安装他人已经编译好的 PyTorch 轮子；</li><li>一种是自己从头开始开始构建 PyTorch 轮子并且安装。</li></ul><h2 id=使用轮子安装>使用轮子安装<a hidden class=anchor aria-hidden=true href=#使用轮子安装>#</a></h2><p>可以从我的 <a href=https://github.com/Cassius0924/JetsonPytorch/>GitHub 仓库</a> 直接下载我编译好的 PyTorch 轮子（torch-1.13.0-cuda-11.4-python-3.8-aarch64）。</p><p>安装前先确保 python 版本为 PyTorch 轮子对应的 Python 3.8。</p><p>下载完毕后使用<code>pip install</code>安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -H pip install torch-1.13.0a0+git7c98e70-cp38-cp38-linux_aarch64.whl
</span></span></code></pre></div><p>如果你以前安装过 torch 的其他版本，则需要添加<code>--force-reinstall</code>覆盖安装。</p><p>其他低于 CUDA 11 的 PyTorch 轮子可以在 <a href=https://github.com/Qengineering/PyTorch-Jetson-Nano>Qengineering 的 GitHub 仓库</a> 寻找。</p><h2 id=编译源码安装>编译源码安装<a hidden class=anchor aria-hidden=true href=#编译源码安装>#</a></h2><p>接下来说一下重点，自己从源码构建轮子并安装。自行构建需要花费数个小时的时间。</p><p>PyTroch 1.11.0 以及以上版本只能在 Ubuntu 20.04 上安装。</p><h3 id=安装依赖>安装依赖<a hidden class=anchor aria-hidden=true href=#安装依赖>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get upgrade
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install ninja-build git cmake 
</span></span><span class=line><span class=cl>sudo apt-get install libjpeg-dev libopenmpi-dev libomp-dev ccache libopenblas-dev libblas-dev libeigen3-dev
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo pip3 install -U --user wheel mock pillow
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -H pip3 install testresources <span class=nv>setuptools</span><span class=o>==</span>58.3.0 scikit-build
</span></span></code></pre></div><h3 id=下载源码>下载源码<a hidden class=anchor aria-hidden=true href=#下载源码>#</a></h3><p>请克隆自己需要的 PyTorch 版本，修改<code>-b</code>后的版本参数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone -b v1.13.0 --depth<span class=o>=</span><span class=m>1</span> --recursive https://github.com/pytorch/pytorch.git
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> pytorch
</span></span></code></pre></div><h3 id=扩大交换内存>扩大交换内存<a hidden class=anchor aria-hidden=true href=#扩大交换内存>#</a></h3><p>构建 PyTorch 需要大于 4GB 的 RAM 和 2GB 的交换内存。</p><p>先使用<code>free -m</code>查看当前的交换内存。</p><p>安装<code>dphys-swapfiel</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install dphys-swapfile
</span></span></code></pre></div><p>需要修改两个文件<code>/sbin/dphys-swapfile</code>和<code>/etc/dphys-swapfile</code>。</p><p>先修改<code>/sbin/dphys-swapfile</code>的第30行，将<code>CONF_MAXSWAP=2048</code>修改成<code>4096</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim /sbin/dphys-swapfile
</span></span></code></pre></div><p><img alt=/sbin/dphys-swapfile loading=lazy src=https://s2.loli.net/2023/10/13/omvFEQWBjHRyIKO.png></p><p>再修改<code>/etc/dphys-swapfile</code>的第26行，将<code>#</code>去掉，后面加上<code>4096</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim /etc/dphys-swapfile
</span></span></code></pre></div><p><img alt=/etc/dphys-swapfile loading=lazy src=https://s2.loli.net/2023/10/13/UVB2AKEsSbHTuWt.png></p><p>保存修改后重启系统。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo reboot
</span></span></code></pre></div><p>重启完毕后可以使用 <code>free -m</code> 查看交换内存是否扩大成功。</p><h2 id=使用-gcc>使用 GCC<a hidden class=anchor aria-hidden=true href=#使用-gcc>#</a></h2><p>请使用 GCC 和 G++ 编译器，如果使用 GNU 编译器会导致浮点数出现错误的问题，使用 Clang 编译器在构建 CUDA 11.4 的 PyTorch 时候会报错。</p><h2 id=设置-cuda-版本>设置 CUDA 版本</h2><h3 id=修改环境变量>修改环境变量<a hidden class=anchor aria-hidden=true href=#设置-cuda-版本>#</a></h3><p>修改系统环境变量，如果你使用的是 bash 则修改 <code>~/.bashrc</code>，如果使用 zsh 则修改 <code>~/.zshrc</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim ~/.zshrc <span class=c1>#或 ~/.bashrc</span>
</span></span></code></pre></div><p>在文件末尾添加三行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CUDA_HOME</span><span class=o>=</span>/usr/local/cuda
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span><span class=nv>$LD_LIBRARY_PATH</span>:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:<span class=nv>$CUDA_HOME</span>/bin
</span></span></code></pre></div><p>如果你之前添加过 CUDA 的环境变量，则直接在对应行修改。</p><p>保存并退出，应用修改：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.zshrc <span class=c1>#或 ~/.bashrc</span>
</span></span></code></pre></div><h3 id=切换-cuda-版本>切换 CUDA 版本<a hidden class=anchor aria-hidden=true href=#切换-cuda-版本>#</a></h3><p>先切换系统 CUDA 版本到即将编译的 CUDA 版本，这里以 CUDA 11.4 为例。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo update-alternatives --config cuda
</span></span></code></pre></div><p>选择<code>2</code>，回车。</p><p><img alt="update-alternatives cuda" loading=lazy src=https://s2.loli.net/2023/10/13/hqS3wJzZbT7GtKo.png></p><h3 id=修改-cmakeliststxt>修改 CMakeLists.txt<a hidden class=anchor aria-hidden=true href=#修改-cmakeliststxt>#</a></h3><p>需要在 CMakeLists.txt 文件里指定 CUDA 编译器的路径。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> pytorch
</span></span><span class=line><span class=cl>vim CMakeLists.txt
</span></span></code></pre></div><p>在 <code>project(Torch CXX C)</code>上方添加一行 <code>set(CMAKE_CUDA_COMPILER /usr/local/cuda/bin/nvcc)</code></p><p><img alt=CMAKE_CUDA_COMPILER loading=lazy src=https://s2.loli.net/2023/10/13/4dqANWEFkuxYcei.png></p><p>保存并退出。</p><h2 id=构建-pytorch>构建 PyTorch</h2><h3 id=设置-ninja-构建参数>设置 Ninja 构建参数<a hidden class=anchor aria-hidden=true href=#构建-pytorch>#</a></h3><p>需要添加一些环境变量。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>BUILD_CAFFE2_OPS</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_FBGEMM</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_FAKELOWP</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>BUILD_TEST</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_MKLDNN</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_NNPACK</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_XNNPACK</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_QNNPACK</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_PYTORCH_QNNPACK</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_CUDA</span><span class=o>=</span>ON
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_CUDNN</span><span class=o>=</span>ON
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TORCH_CUDA_ARCH_LIST</span><span class=o>=</span><span class=s2>&#34;5.3;6.2;7.2&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_NCCL</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_SYSTEM_NCCL</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>USE_OPENCV</span><span class=o>=</span>OFF
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>MAX_JOBS</span><span class=o>=</span><span class=m>4</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span>/usr/lib/ccache:<span class=nv>$PATH</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CC</span><span class=o>=</span>gcc
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CXX</span><span class=o>=</span>g++
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CUDACXX</span><span class=o>=</span>/usr/local/cuda/bin/nvcc
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>CUDA_TOOLKIT_ROOT_DIR</span><span class=o>=</span>/usr/local/cuda
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo ln -s /usr/lib/aarch64-linux-gnu/libcublas.so /usr/local/cuda/lib64/libcublas.so
</span></span></code></pre></div><h3 id=开始构建-pytorch>开始构建 PyTorch<a hidden class=anchor aria-hidden=true href=#开始构建-pytorch>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 setup.py bdist_wheel
</span></span></code></pre></div><p>如果构建过程中报错，需要重新构建，请先用<code>python3 setup.py clean</code>重置构建。</p><h2 id=安装-pytorch>安装 PyTorch<a hidden class=anchor aria-hidden=true href=#安装-pytorch>#</a></h2><p>经过漫长的编译，编译好的<code>.whl</code>轮子文件会放在<code>dist</code>文件夹里。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> dist
</span></span><span class=line><span class=cl>sudo -H pip3 install &lt;torch文件&gt;.whl
</span></span></code></pre></div><p>如果你以前安装过 torch 的其他版本，则需要添加<code>--force-reinstall</code>覆盖安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -H pip3 install &lt;torch文件&gt;.whl --force-reinstall
</span></span></code></pre></div><h2 id=验证安装>验证安装<a hidden class=anchor aria-hidden=true href=#验证安装>#</a></h2><p>导入验证 torch 不能在 PyTorch 源代码目录，否则会报错，先用<code>cd ../..</code>退出源代码文件夹。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -c <span class=s2>&#34;import torch as t; print(t.__version__); print(t.version.cuda); print(t.cuda.is_available());&#34;</span>
</span></span></code></pre></div><p><img alt="CleanShot 2023-10-13 at 11.05.01@2x" loading=lazy src=https://s2.loli.net/2023/10/13/FybLW9Ad5sVOfGR.png></p><p>大功告成！</p><h2 id=清理空间>清理空间<a hidden class=anchor aria-hidden=true href=#清理空间>#</a></h2><p>先停 dphys-swapfile：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo /etc/init.d/dphys-swapfile stop
</span></span></code></pre></div><p>如果磁盘空间紧缺，可以将 PyTorch 源代码删除，不过删除前建议先将 Jetson 辛辛苦苦构建 PyTorch 轮子备份保存一下。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mv pytorch/dist/*.whl ~
</span></span></code></pre></div><p>删除源代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>rm -r pytorch
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.cassdev.com/tags/jetson/>Jetson</a></li><li><a href=https://blog.cassdev.com/tags/pytorch/>PyTorch</a></li><li><a href=https://blog.cassdev.com/tags/cuda/>CUDA</a></li><li><a href=https://blog.cassdev.com/tags/installation/>Installation</a></li><li><a href=https://blog.cassdev.com/tags/tutorial/>Tutorial</a></li></ul></footer></article></main><footer class=footer><span>Copyright © 2025-2025 Cassius0924. All rights reserved.</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>