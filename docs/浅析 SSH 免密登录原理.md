---
layout: '../../layouts/MarkdownPost.astro'
title: '浅析 SSH 免密登录原理'
pubDate: 2023-03-28
description: '本文旨在以简单易懂的方式解释SSH免密登录的原理。'
author: 'Cassius0924'
cover:
    url: 'https://s2.loli.net/2023/03/28/8an6PHflIvZytdo.png'
    square: 'https://s2.loli.net/2023/03/28/RZc1M34LgDpEolw.png'
    alt: 'SSH'
tags: ["Linux", "SSH", "Passwordless"]
theme: 'light'
featured: ture
---

# 浅析 SSH 免密登录原理

![GitHub Security](https://s2.loli.net/2023/03/28/RZc1M34LgDpEolw.png)

SSH（Secure Shell）是一种网络协议，可以在不安全的网络中提供一种安全的加密通信方式。SSH 免密登录是指用户在登录远程主机时，无需输入密码即可完成登录，免去每次登录时输入密码的烦恼。这种方式既提高了用户的操作便捷性，又避免了使用简单密码的风险，极大地提高了登录的安全性。本文旨在以简单易懂的方式解释SSH免密登录的原理。

## SSH免密登录原理

### 非对称加密

在了解SSH免密登录原理之前，我们需要先了解“非对称加密”。SSH 免密登录原理是基于非对称加密技术。

非对称加密就是指加密数据和解密数据用的是不同密钥，密钥分为加密密钥和解密密钥，将这样的两个密钥称为密钥对。

用户用**加密密钥**加密的数据只能用**解密密钥**才能解密，而且两个密钥相对独立，知道了其中的一个密钥，并不能计算出另一个密钥。因此我们可以公开其中的一个密钥，保密另一个密钥。公开的密钥称为公钥，不公开的密钥称为密钥。在 SSH 协议中**加密密钥为公钥，解密密钥为私钥**，这也被称为“公钥加密技术”。

因此，私钥应该妥善保管，防止泄露。如果私钥安全，那么 SSH 免密登录将是一种非常安全的登录方式。

除了提高操作便捷性和登录安全性之外，SSH 免密登录还可以减少用户输入密码的次数。这对于需要频繁登录远程主机的用户来说尤为重要。此外，SSH 免密登录还可以实现自动化脚本的编写和远程服务器的管理，从而提高工作效率。

总之，了解 SSH 免密登录的原理可以帮助用户更好地使用该功能，保证登录的安全性和便捷性。同时，用户在使用 SSH 免密登录时，也应该注意保护自己的私钥，避免私钥泄露，以确保登录的安全性。

> 不难猜到，与非对称加密相反的**对称加密**指的就是加密与解密用的是**同一个密钥**。此种加密方法安全性低。

### 免密登录流程

![SSH免密登录流程](https://s2.loli.net/2023/03/27/Sl6N7qFGcojrWQw.png)

SSH免密登录原理基于公钥加密技术，具体步骤如下：

1. 用户在本地生成`id_rsa.pub`公钥和`id_rsa`私钥；

   > 命令：`ssh-keygen`

2. 并且私钥只用于解密数据，公钥只用于加密数据。私钥**只保存在本地**，公钥复制一份到远程服务器上；

   > 命令：`ssh-copy-id`

3. 当用户通过SSH协议连接远程服务器时，会发送包含`username`的数据用于请求连接，服务器在接下来的操作中会使用与`username`**相对应的公钥**；

   > 命令：`ssh username@remote_host`

4. 服务器会生成一个随机数，称之为 Challenge，并将 Challenge 使用**公钥加密**后发送给用户；

5. 用户使用**私钥**对 Challenge 进行**解密**；

6. 再将解密后的数据再用 MD5 加密一遍发送回服务器；

7. 服务器会对比原始 Chanllenge 的 MD5 值和用户发送过来的 MD5值，若一致则允许用户登录，否则拒绝登录。

## 使用方法

1. 首先在本地生成一对公私钥，可以使用以下命令：

```bash
ssh-keygen -t rsa
```

这个命令会在用户目录`~`下生成一个 `.ssh` 文件夹，里面包含私钥和公钥。

2. 将公钥上传到远程服务器，可以使用以下命令：

```bash
ssh-copy-id username@remote_host
```

其中，`username`为远程服务器的用户名，`remote_host`为远程服务器的IP地址或域名。

3. 登录远程服务器时，可以使用以下命令：

```bash
ssh username@remote_host
```

## 写在最后

除了提高操作便捷性和登录安全性之外，SSH 免密登录还可以减少用户输入密码的次数。这对于需要频繁登录远程主机的用户来说尤为重要。此外，SSH 免密登录还可以实现自动化脚本（例如GitHub Actions）的编写和远程服务器的管理，从而提高工作效率。

总之，了解 SSH 免密登录的原理可以帮助用户更好地使用该功能，保证登录的安全性和便捷性。同时，用户在使用 SSH 免密登录时，也应该注意保护自己的私钥，避免私钥泄露，以确保登录的安全性。
